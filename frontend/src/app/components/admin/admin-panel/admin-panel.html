<div class="admin-panel">
  <!-- Left Sidebar Navigation -->
  <aside class="admin-sidebar">
    <div class="sidebar-header">
      <h2 class="sidebar-title">Admin Panel</h2>
    </div>
    <nav class="sidebar-nav">
      <button
        class="nav-tab"
        [class.active]="activeTab() === 'general'"
        (click)="activeTab.set('general')"
        type="button">
        <span class="tab-icon">üìä</span>
        <span class="tab-label">General</span>
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab() === 'products'"
        (click)="activeTab.set('products')"
        type="button">
        <span class="tab-icon">üì¶</span>
        <span class="tab-label">Products</span>
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab() === 'sales'"
        (click)="activeTab.set('sales')"
        type="button">
        <span class="tab-icon">üí∞</span>
        <span class="tab-label">Sales</span>
      </button>
      <button
        class="nav-tab"
        [class.active]="activeTab() === 'users'"
        (click)="activeTab.set('users')"
        type="button">
        <span class="tab-icon">üë•</span>
        <span class="tab-label">Users</span>
      </button>
    </nav>
  </aside>

  <!-- Main Content Area -->
  <main class="admin-content">
    <!-- General Tab -->
    @if (activeTab() === 'general') {
      <header class="admin-header">
        <h1 class="admin-title">Dashboard Overview</h1>
        <p class="admin-subtitle">Welcome back, {{ currentUser()?.name }}</p>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üì¶</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().total }}</div>
            <div class="stat-label">Total Products</div>
          </div>
        </div>

        <div class="stat-card warning">
          <div class="stat-icon">‚ö†Ô∏è</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().lowStock }}</div>
            <div class="stat-label">Low Stock</div>
          </div>
        </div>

        <div class="stat-card success">
          <div class="stat-icon">‚ú®</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().newProducts }}</div>
            <div class="stat-label">New Items</div>
          </div>
        </div>

        <div class="stat-card info">
          <div class="stat-icon">üî•</div>
          <div class="stat-content">
            <div class="stat-value">{{ stats().bestsellers }}</div>
            <div class="stat-label">Bestsellers</div>
          </div>
        </div>
      </div>

      <div class="quick-actions">
        <h2 class="section-title">Quick Actions</h2>
        <div class="action-cards">
          <button class="action-card" (click)="activeTab.set('products')" type="button">
            <span class="action-icon">‚ûï</span>
            <span class="action-label">Add Product</span>
          </button>
          <button class="action-card" (click)="activeTab.set('sales')" type="button">
            <span class="action-icon">üìà</span>
            <span class="action-label">View Sales</span>
          </button>
          <button class="action-card" (click)="activeTab.set('users')" type="button">
            <span class="action-icon">üîç</span>
            <span class="action-label">Find User</span>
          </button>
        </div>
      </div>
    }

    <!-- Products Tab -->
    @if (activeTab() === 'products') {
      <header class="admin-header">
        <div class="header-content">
          <h1 class="admin-title">Product Management</h1>
          <p class="admin-subtitle">Manage your shop inventory</p>
        </div>
      </header>

      @if (isLoading()) {
        <div class="loading-container">
          <div class="spinner"></div>
          <p>Loading products...</p>
        </div>
      }

      @if (errorMessage() && !isLoading()) {
        <div class="error-container">
          <p class="error-message">{{ errorMessage() }}</p>
          <button class="btn-retry" (click)="loadProducts()" type="button">
            Retry
          </button>
        </div>
      }

      @if (!isLoading() && !errorMessage()) {
        <!-- Stats Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-icon">üì¶</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats().total }}</div>
              <div class="stat-label">Total Products</div>
            </div>
          </div>

          <div class="stat-card warning">
            <div class="stat-icon">‚ö†Ô∏è</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats().lowStock }}</div>
              <div class="stat-label">Low Stock</div>
            </div>
          </div>

          <div class="stat-card success">
            <div class="stat-icon">‚ú®</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats().newProducts }}</div>
              <div class="stat-label">New Items</div>
            </div>
          </div>

          <div class="stat-card info">
            <div class="stat-icon">üî•</div>
            <div class="stat-content">
              <div class="stat-value">{{ stats().bestsellers }}</div>
              <div class="stat-label">Bestsellers</div>
            </div>
          </div>
        </div>

        <!-- Search and Actions Bar -->
        <div class="actions-bar">
          <div class="search-box">
            <input
              type="text"
              class="search-input"
              placeholder="Search products by title, category, or tags..."
              [(ngModel)]="searchQuery"
            />
            <span class="search-icon">üîç</span>
          </div>
          <button class="btn-primary" (click)="openEditor()" type="button">
            <span class="btn-icon">+</span>
            Add Product
          </button>
        </div>

        <!-- Products Table -->
        <div class="products-table-container">
          <table class="products-table">
            <thead>
              <tr>
                <th>Product</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Badges</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (product of filteredProducts(); track product.id) {
                <tr class="product-row">
                  <!-- Product Info -->
                  <td class="product-cell">
                    <div class="product-info">
                      <img
                        [src]="getImageUrl(product.images[0])"
                        [alt]="product.title"
                        class="product-thumb"
                      />
                      <div class="product-text">
                        <div class="product-title">{{ product.title }}</div>
                        @if (product.subtitle) {
                          <div class="product-subtitle">{{ product.subtitle }}</div>
                        }
                      </div>
                    </div>
                  </td>

                  <!-- Category -->
                  <td class="category-cell">
                    <span class="category-badge">{{ product.category }}</span>
                  </td>

                  <!-- Price -->
                  <td class="price-cell">
                    <div class="price-info">
                      <span class="price">${{ product.price }}</span>
                      @if (product.salePrice) {
                        <span class="sale-price">${{ product.salePrice }}</span>
                      }
                    </div>
                  </td>

                  <!-- Stock Manager -->
                  <td class="stock-cell">
                    <app-stock-manager
                      [product]="product"
                      (stockUpdated)="onStockUpdated(product.id, $event)"
                    ></app-stock-manager>
                  </td>

                  <!-- Badge Toggles -->
                  <td class="badges-cell">
                    <app-badge-toggle
                      [product]="product"
                      (badgeToggled)="onBadgeToggled(product.id, $event)"
                    ></app-badge-toggle>
                  </td>

                  <!-- Actions -->
                  <td class="actions-cell">
                    <div class="action-buttons">
                      <button
                        class="btn-action btn-edit"
                        (click)="openEditor(product)"
                        type="button"
                        title="Edit product"
                      >
                        ‚úèÔ∏è
                      </button>
                      <button
                        class="btn-action btn-delete"
                        (click)="showDeleteConfirm.set(true); productToDelete.set(product)"
                        type="button"
                        title="Delete product"
                      >
                        üóëÔ∏è
                      </button>
                    </div>
                  </td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="6" class="empty-state">
                    <div class="empty-content">
                      <div class="empty-icon">üì¶</div>
                      <p>No products found</p>
                      @if (searchQuery()) {
                        <button
                          class="btn-secondary"
                          (click)="searchQuery.set('')"
                          type="button"
                        >
                          Clear Search
                        </button>
                      }
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    }

    <!-- Sales Tab -->
    @if (activeTab() === 'sales') {
      <header class="admin-header">
        <h1 class="admin-title">Sales Analytics</h1>
        <p class="admin-subtitle">Track your shop performance</p>
      </header>

      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-icon">üíµ</div>
          <div class="stat-content">
            <div class="stat-value">$0.00</div>
            <div class="stat-label">Total Revenue</div>
          </div>
        </div>

        <div class="stat-card success">
          <div class="stat-icon">üìà</div>
          <div class="stat-content">
            <div class="stat-value">0</div>
            <div class="stat-label">Orders Today</div>
          </div>
        </div>

        <div class="stat-card info">
          <div class="stat-icon">üìä</div>
          <div class="stat-content">
            <div class="stat-value">0</div>
            <div class="stat-label">Total Orders</div>
          </div>
        </div>

        <div class="stat-card warning">
          <div class="stat-icon">‚≠ê</div>
          <div class="stat-content">
            <div class="stat-value">$0.00</div>
            <div class="stat-label">Avg Order Value</div>
          </div>
        </div>
      </div>

      <div class="content-section">
        <h2 class="section-title">Sales Data</h2>
        <div class="placeholder-content">
          <div class="placeholder-icon">üìä</div>
          <p class="placeholder-text">Sales analytics are currently in demo mode</p>
          <p class="placeholder-subtext">In a live environment, this would show charts, graphs, and detailed sales metrics</p>
        </div>
      </div>
    }

    <!-- Users Tab -->
    @if (activeTab() === 'users') {
      <header class="admin-header">
        <h1 class="admin-title">User Management</h1>
        <p class="admin-subtitle">Search and manage user accounts</p>
      </header>

      <div class="search-section">
        <div class="search-box-large">
          <input
            type="text"
            class="search-input"
            placeholder="Search by email, name, or order number..."
            [(ngModel)]="userSearchQuery"
          />
          <span class="search-icon">üîç</span>
        </div>
      </div>

      <div class="content-section">
        @if (userSearchQuery()) {
          <div class="placeholder-content">
            <div class="placeholder-icon">üë§</div>
            <p class="placeholder-text">User search is currently in demo mode</p>
            <p class="placeholder-subtext">In a live environment, searching for "{{ userSearchQuery() }}" would display:</p>
            <ul class="feature-list">
              <li>User account details</li>
              <li>Order history and status</li>
              <li>Shopping behavior data</li>
              <li>Account management options (blacklist email, etc.)</li>
            </ul>
          </div>
        } @else {
          <div class="placeholder-content">
            <div class="placeholder-icon">üîç</div>
            <p class="placeholder-text">Enter a search term to find users</p>
            <p class="placeholder-subtext">Search by email, name, or order number</p>
          </div>
        }
      </div>
    }

    <!-- Product Editor Modal -->
    @if (showEditor()) {
      <app-product-editor
        [product]="selectedProduct()"
        (save)="handleEditorSave($event)"
        (cancel)="showEditor.set(false); selectedProduct.set(null)"
      ></app-product-editor>
    }

    <!-- Delete Confirmation Modal -->
    @if (showDeleteConfirm()) {
      <div class="modal-overlay" (click)="showDeleteConfirm.set(false)">
        <div class="modal-content delete-modal" (click)="$event.stopPropagation()">
          <h3 class="modal-title">Delete Product?</h3>
          <p class="modal-text">
            Are you sure you want to delete
            <strong>{{ productToDelete()?.title }}</strong>? This action cannot be
            undone.
          </p>
          <div class="modal-actions">
            <button
              class="btn-secondary"
              (click)="showDeleteConfirm.set(false)"
              type="button"
            >
              Cancel
            </button>
            <button
              class="btn-danger"
              (click)="deleteProduct(productToDelete()!)"
              type="button"
            >
              Delete
            </button>
          </div>
        </div>
      </div>
    }
  </main>
</div>
